<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Selection</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #gallery { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
    .img-item { margin: 10px; border: 2px solid transparent; cursor: pointer; }
    .img-item.selected { border: 2px solid #007BFF; }
    img { width: 150px; height: auto; display: block; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>Enter your email dfdf</h2>
  <input type="email" id="email" placeholder="you@example.com" required>
  <button onclick="loadImages()">Submit</button>

  <div id="gallery"></div>
  <button id="sendBtn" style="display:none;" onclick="sendSelection()">Send Selection</button>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwDwEiwlv3-dey3GKhcmWge-iICPn_UToQRPJ6iUVbeLD1vpGUT4xS3eb7-POiisMsh/exec"; // <-- Replace this

    let userEmail = "";
    let images = [];

    function loadImages() {
      userEmail = document.getElementById("email").value.trim();
      if (!userEmail) {
        alert("Please enter your email first.");
        return;
      }

      fetch(`${scriptURL}?action=getImages`)
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            images = data.images;
            renderGallery(images);
          } else {
            alert("Error: " + data.message);
          }
        })
        .catch(err => alert("Error loading images: " + err.message));
    }

    function renderGallery(imgs) {
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";

      imgs.forEach((img, index) => {
        const div = document.createElement("div");
        div.className = "img-item";
        div.onclick = () => div.classList.toggle("selected");

        div.innerHTML = `
          <img src="${img.url}" alt="${img.name}">
          <p>${img.name}</p>
        `;

        gallery.appendChild(div);
      });

      document.getElementById("sendBtn").style.display = "block";
    }

    function sendSelection() {
      const selected = Array.from(document.querySelectorAll(".img-item.selected"))
        .map((div, index) => images[index]);

      if (selected.length === 0) {
        alert("Please select at least one image.");
        return;
      }

      fetch(scriptURL, {
        method: "POST",
        mode: "cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          action: "sendSelection",
          email: userEmail,
          images: selected
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          alert("Your selection has been sent successfully!");
        } else {
          alert("Error: " + data.message);
        }
      })
      .catch(err => alert("Error sending: " + err.message));
    }
  </script>
</body>
</html>
